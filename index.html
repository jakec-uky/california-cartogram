<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Cartogram Test</title>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css">

	<style type="text/css">
		body {
      /*background-color: #eeeeee;*/
      color: #333333;
      font-family: sans-serif;
    }
		h1 {
			margin-bottom: 0;
		}
		h2 {
			margin-top: 3px;
		}
		p {
			margin: 5px 1em 1em 5px;
		}
		#descriptive-text {
			float: left;
			width: 25%;
			height: 700px;
			overflow: scroll;
		}
    #map {
      border: 1px solid #dddddd;
      height: 700px;
      margin-bottom: 2rem;
			background-color: #dddddd;
			position: relative;
		}
		#inset-map {
			position: absolute;
			width: 220px;
			height: 220px;
			left: 18px;
			bottom: 18px;
			background-color: #dddddd;
			border: 2px solid #ffffff;
		}
		#ui-slider{
			width: 130px;
		}
		#ui-slider .min {
			float:left;
		}
		#ui-slider .max {
			float:right;
		}
		.legend-label {
			position: absolute;
			width: 0px;
			font-size: 1em;
			background-color: rgba(0,0,0,0);
			border: 0px solid rgba(0,0,0,0);
			box-shadow: 0 1px 3px rgba(0,0,0,0);
		}
		.legend-label::before {
			border-right-color: rgba(0,0,0,0);
		}
		.legend-label p {
			margin: 0;
		}
		.legend-label hr {
			width: 10px;
			margin: 0;
		}
		#inset-map .leaflet-tooltip-left:before {
			border-left-color: rgba(0,0,0,0)
		}
	</style>
</head>

<body>

	<h1>A Century of Growth</h1>
	<h2>population in California, 1900&ndash;2000</h2>
	<div id="descriptive-text">
		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean quis dolor enim. Morbi posuere orci et erat feugiat faucibus quis a nunc. Morbi pharetra odio et tellus ultrices, vitae gravida arcu mattis. Vestibulum vitae purus iaculis, pellentesque nisl vitae, tincidunt diam. Vivamus at velit purus. Mauris pretium sapien risus, blandit sollicitudin orci faucibus a. Nullam convallis hendrerit bibendum. Pellentesque ex erat, vulputate ut placerat in, vehicula at diam. Sed nec ex sed tellus placerat bibendum. Morbi sollicitudin dolor vel feugiat viverra. Praesent cursus justo ac lacus condimentum, viverra mattis erat congue. Maecenas venenatis mi sit amet elit vestibulum scelerisque. Maecenas consectetur nibh et libero pulvinar maximus. Duis sed ultrices ipsum. Suspendisse maximus vitae odio eu fermentum. Integer mattis sit amet nisl ac lobortis.</p>
		<p>Sed blandit gravida commodo. Ut sem orci, semper iaculis dictum et, fermentum in odio. Aliquam at varius elit, non auctor tortor. Vivamus eget diam lacus. Fusce euismod non magna non pulvinar. In nisl turpis, porta a tempus nec, rutrum a orci. Nam libero nisi, dapibus in ex et, venenatis viverra risus. Ut at nunc lectus. In at dolor magna. Sed sollicitudin, enim eget tempor ultrices, tellus odio scelerisque erat, a pretium arcu mi at tortor. Morbi commodo diam eu tempus cursus. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Pellentesque id ex eros. Etiam nec mattis mauris.</p>
		<p>Integer sed augue lacus. Vestibulum eu interdum nulla. Quisque et lacus mauris. Donec aliquam hendrerit tincidunt. Nam et lectus leo. Aliquam odio lacus, tristique eget imperdiet vel, vulputate ut lectus. Integer leo diam, aliquet non arcu ac, euismod aliquam nunc. Sed vitae quam convallis ligula pretium fermentum. Phasellus at sapien fringilla, ultrices elit gravida, tempor leo. Morbi sed ligula nec ligula venenatis scelerisque. Praesent varius velit urna, et vehicula turpis luctus at. Phasellus non est sit amet mi gravida tincidunt. Mauris eu lorem ut ipsum cursus aliquam.</p>
	</div>
	<div id="map">
		<div id="inset-map"><p>Number of persons</p>
		</div>
	</div>
	<!-- <div id="ui-slider">
		<label>
			<span class="min">1900</span>
			<span class="max">2000</span>
			<input type="range" min="1900" max="2000" value="1900" step="100" class="decade-slider"/></input>
		</label>
	</div> -->
	<form>
			<p>choose a year</p>
			<div>
				<input type="radio"
				 name="contact" value="1900">
				<label for="contactChoice1">1900</label>

				<input type="radio"
				 name="contact" value="1920">
				<label for="contactChoice1">1920</label>

				<input type="radio"
				 name="contact" value="1940">
				<label for="contactChoice2">1940</label>

				<input type="radio"
				 name="contact" value="1960">
				<label for="contactChoice1">1960</label>

				<input type="radio"
				 name="contact" value="1980">
				<label for="contactChoice1">1980</label>

				<input type="radio"
				 name="contact" value="2000" checked>
				<label for="contactChoice3">2000</label>
			</div>
		</form>
  <p>experimental draft by Jake Coolidge</p>
  <p>data source: US Census</p>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.3.6/papaparse.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.5/chroma.min.js"></script>

	<script>


		var options = {
			scrollWheelZoom: true,
			zoomSnap: .2,
			dragging: true,
			zoomControl: true,
			center: [40, -127],
			zoom: 5,
			minZoom: 5,
			maxZoom: 7

		}

		var map = L.map('map', options);//.setView([41.505, -116.09], 5);



		var insetMap = L.map('inset-map', {
			center: [0,0],
			zoom: 5,
			zoomControl: false,
			attribution: false,
			zoomSnap: .2,
			scrollWheelZoom: false
			// pan false
		})

		var legendLabel10k = new L.marker([-0.6862,-0.91], {opacity: 0.00});
		legendLabel10k.bindTooltip("<p>10,000</p>", {permanent: true, className: "legend-label", direction: "left", offset: [-11,28]});
		legendLabel10k.addTo(insetMap);

		var legendLabel640k = new L.marker([0.91,-0.91], {opacity: 0.00});//[0.91,0.91]
		legendLabel640k.bindTooltip("<p>640,000</p>", {permanent: true, className: "legend-label", direction: "left", offset: [-20,28]});
		legendLabel640k.addTo(insetMap);

		// L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		// 	maxZoom: 19,
		// 	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
		// }).addTo(insetMap)

		map.on("zoomend", function() {
			var currentZoomLevel = map.getZoom()
			insetMap.setZoom(currentZoomLevel)
		})

		// deferred requests for data
		var data2000 = $.getJSON("data/ca_cartogram_2000.json"),
				data1980 = $.getJSON("data/ca_cartogram_1980.json"),
				data1960 = $.getJSON("data/ca_cartogram_1960.json"),
				data1940 = $.getJSON("data/ca_cartogram_1940.json"),
				data1920 = $.getJSON("data/ca_cartogram_1920.json"),
				data1900 = $.getJSON("data/ca_cartogram_1900.json")
				legendData = $.getJSON("data/legend.json")

		// map
		var layerMap = {
			1900: data1900,
			1920: data1920,
			1940: data1940,
			1960: data1960,
			1980: data1980,
			2000: data2000
		}

		$.when(data2000, data1980, data1960, data1940, data1920, data1900, legendData).then(ready);

		function ready(data2000, data1980, data1960, data1940, data1920, data1900, legendData) {

			// drawLegend(legendGeoJson)

			drawCartogram(data2000)
			buildUI(data2000, data1980, data1960, data1940, data1920, data1900)
			drawLegend(legendData)

		}

		function drawLegend(data) {

			L.geoJson(data, {
				style: function(feature) {
					return {
						color: '#ffffff',
						weight: 1,
						fillOpacity: 0,
						fillColor: '#000000'
					}
				},
				onEachFeature: function(feature, layer) {
					layer.on('mouseover', function(){
						layer.setStyle({
							color: '#f0f40f',
							weight: 2
						}).bringToFront();
					})
					layer.on('mouseout', function(){
						layer.setStyle({
							color: '#ffffff',
							weight: 1
						})
					})
					var legendTooltip = layer.feature.properties["label"];
					layer.bindTooltip(legendTooltip, {
						sticky: true,
						tooltipAnchor: [200, 200]
					})
				}
			}).addTo(insetMap)

		}

    function drawCartogram(geojson) {

			map.eachLayer(function(layer) {
				map.removeLayer(layer);
			})

      L.geoJson(geojson, {
        style: function(feature) {
          return {
            color: '#ffffff',
            weight: 1,
            fillOpacity: 1,
            fillColor: feature.properties["hex"]//'#000000'
          }
        },
        onEachFeature: function(feature, layer) {
          layer.on('mouseover', function(){
            layer.setStyle({
              color: '#f0f40f',
              weight: 2
            })//.bringToFront();
          });
          layer.on('mouseout', function() {
            layer.setStyle({
              color: '#ffffff',
              weight: 1
            });
          });
          var tooltipInfo = layer.feature.properties["name"] + " County<br />pop. " + layer.feature.properties["year"] + ": "+ layer.feature.properties["population"].toLocaleString();
          layer.bindTooltip(tooltipInfo, {
            sticky: true,
            tooltipAnchor: [200, 200]
          })
        }
      }).addTo(map);

      // map.fitBounds(dataLayer.getBounds(), {
      //   paddingTopLeft: [0,0]
      // });
		}

		function buildUI(data2000, data1980, data1960, data1940, data1920, data1900) {

			$("form input").on("input change", function() {
				drawCartogram(layerMap[this.value].responseJSON)
			})



		}

	</script>

</body>

</html>
